<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå">
    <meta name="keywords" content="‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î, ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç">
    <title>Durian Analytics - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <a href="index.html">
                <img src="logo.png" alt="Durian Analytics Logo" class="nav-logo">
                <h1 class="animate-color">Durian Analytics</h1>
            </a>
        </div>
        <div class="nav-menu">
            <div class="user-menu" id="userMenu" style="display: none;">
                <span id="userName"></span>
                <button onclick="handleLogout()" class="logout-button">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
            <div class="auth-buttons" id="authButtons">
                <a href="login.html" class="login-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                <a href="register.html" class="register-button">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</a>
            </div>
        </div>
    </nav>

    <div class="container" id="mainContent">
        <div class="dashboard-title">
            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <div class="analysis-input">
            <h2>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
            <div class="source-selector">
                <div class="source-item">
                    <input type="checkbox" id="facebook" checked>
                    <label for="facebook">Facebook</label>
                </div>
                <div class="source-item">
                    <input type="checkbox" id="twitter" checked>
                    <label for="twitter">Twitter</label>
                </div>
                <div class="source-item">
                    <input type="checkbox" id="instagram" checked>
                    <label for="instagram">Instagram</label>
                </div>
            </div>
            <textarea id="analysis-text" placeholder="‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå..."></textarea>
            <div class="text-validation" style="color: var(--error-color); font-size: 0.9em; margin-top: 8px; display: none;"></div>
            <div class="button-group">
                <button class="interactive-button" id="analyze-btn" onclick="analyzeText()">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                <a href="history.html" class="history-button" id="history-btn" style="display: none;">
                    <span class="history-icon">üìã</span> ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                </a>
                <button class="save-button" id="save-btn" onclick="saveAnalysis()" style="display: none;">
                    <span class="save-icon">üíæ</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                </button>
                <div class="login-prompt" id="login-prompt" style="display: none;">
                    <a href="login.html" class="login-link">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                </div>
            </div>
        </div>
        <div id="analyze-toast" style="display:none;position:fixed;bottom:32px;left:50%;transform:translateX(-50%);background:linear-gradient(45deg,var(--primary-color),var(--secondary-color));color:#fff;padding:14px 32px;border-radius:24px;box-shadow:0 2px 12px rgba(0,0,0,0.12);font-size:1.1em;z-index:9999;transition:opacity 0.3s;opacity:0;"></div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: white; padding: 24px; border-radius: 12px; text-align: center;">
                <div class="loading-spinner"></div>
                <p style="margin-top: 16px; color: var(--text-color);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</p>
            </div>
        </div>

        <!-- Error Modal -->
        <div id="error-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
            <div style="background: white; padding: 24px; border-radius: 12px; text-align: center; max-width: 400px;">
                <h3 style="color: var(--error-color); margin-bottom: 16px;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                <p id="error-message" style="margin-bottom: 24px;"></p>
                <button onclick="closeErrorModal()" class="interactive-button">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h2 class="card-title">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å</h2>
                <div class="chart-container">
                    <canvas id="sentimentChart"></canvas>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value">65%</div>
                        <div class="metric-label">‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">25%</div>
                        <div class="metric-label">‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">10%</div>
                        <div class="metric-label">‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h2>
                <div class="keyword-analysis">
                    <div class="keyword-category">
                        <div class="keyword-title">‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å</div>
                        <div class="keyword-list">
                            <span class="keyword-item">‡∏´‡∏ß‡∏≤‡∏ô</span>
                            <span class="keyword-item">‡∏≠‡∏£‡πà‡∏≠‡∏¢</span>
                            <span class="keyword-item">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ</span>
                            <span class="keyword-item">‡∏™‡∏î</span>
                            <span class="keyword-item">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤</span>
                        </div>
                    </div>
                    <div class="keyword-category">
                        <div class="keyword-title">‡∏Ñ‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á</div>
                        <div class="keyword-list">
                            <span class="keyword-item">‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                            <span class="keyword-item">‡∏Ç‡∏ô‡∏™‡πà‡∏á</span>
                            <span class="keyword-item">‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</span>
                        </div>
                    </div>
                    <div class="keyword-category">
                        <div class="keyword-title">‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö</div>
                        <div class="keyword-list">
                            <span class="keyword-item">‡πÅ‡∏û‡∏á</span>
                            <span class="keyword-item">‡∏ä‡πâ‡∏≤</span>
                            <span class="keyword-item">‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ï‡∏•‡∏≤‡∏î</h2>
                <div class="trend-header">
                    <div class="trend-filters">
                        <button class="trend-filter active" onclick="updateTimeframe('daily')">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                        <button class="trend-filter" onclick="updateTimeframe('weekly')">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                        <button class="trend-filter" onclick="updateTimeframe('monthly')">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç</h2>
                <div class="campaign-suggestions">
                    <div class="suggestion-item">
                        "‡∏°‡∏´‡∏±‡∏®‡∏à‡∏£‡∏£‡∏¢‡πå‡πÅ‡∏´‡πà‡∏á‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥: ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡∏ó‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏±‡∏ô‡∏ñ‡∏∂‡∏á‡πÉ‡∏à"
                    </div>
                    <div class="suggestion-item">
                        "‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏ô: ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì"
                    </div>
                    <div class="suggestion-item">
                        "‡∏£‡∏≤‡∏ä‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏ú‡∏•‡πÑ‡∏°‡πâ: ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏ó‡∏¢‡πÅ‡∏ó‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å"
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
                    <a href="#">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                    <a href="#">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
                    <a href="#">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
                </div>
                <p>&copy; 2024 Durian Analytics. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div class="tooltip"></div>

    <script>
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        function checkLoginStatus() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userMenu = document.getElementById('userMenu');
            const authButtons = document.getElementById('authButtons');
            const userName = document.getElementById('userName');
            const saveBtn = document.getElementById('save-btn');
            const loginPrompt = document.getElementById('login-prompt');
            const historyBtn = document.getElementById('history-btn');

            if (currentUser) {
                userMenu.style.display = 'flex';
                authButtons.style.display = 'none';
                userName.textContent = currentUser.username;
                historyBtn.style.display = 'inline-flex';
                if (document.querySelector('.analysis-results')) {
                    saveBtn.style.display = 'block';
                    loginPrompt.style.display = 'none';
                }
            } else {
                userMenu.style.display = 'none';
                authButtons.style.display = 'flex';
                historyBtn.style.display = 'none';
                if (document.querySelector('.analysis-results')) {
                    saveBtn.style.display = 'none';
                    loginPrompt.style.display = 'block';
                }
            }
            
            initializeCharts();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ó‡πå
        function handleLogout() {
            localStorage.removeItem('currentUser');
            window.location.reload();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
        function initializeCharts() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            window.sentimentChart = new Chart(sentimentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å', '‡∏Å‡∏•‡∏≤‡∏á', '‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: ['#4AD8B9', '#FFB86B', '#FF9248'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#2C3E50',
                                font: {
                                    size: 12
                                },
                                padding: 15
                            }
                        }
                    },
                    cutout: '70%'
                }
            });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ï‡∏•‡∏≤‡∏î
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            window.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå', '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'],
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á',
                        data: [1200, 1900, 3000, 5000, 4000, 3500, 4200],
                        borderColor: '#4AD8B9',
                        backgroundColor: 'rgba(74, 216, 185, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô',
                            font: {
                                size: 16,
                                weight: '500'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#2C3E50',
                            bodyColor: '#2C3E50',
                            borderColor: '#E1E8F0',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + context.parsed.y.toLocaleString() + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#E1E8F0',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#2C3E50',
                                font: {
                                    size: 12
                                },
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#2C3E50',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            document.querySelector('.trend-filter').classList.add('active');
        });

        function validateText(text) {
            const validationDiv = document.querySelector('.text-validation');
            if (!text.trim()) {
                validationDiv.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå';
                validationDiv.style.display = 'block';
                return false;
            }
            validationDiv.style.display = 'none';
            return true;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Loading State
        function showLoading(message = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...') {
            const loadingOverlay = document.getElementById('loading-overlay');
            const loadingMessage = loadingOverlay.querySelector('p');
            loadingMessage.textContent = message;
            loadingOverlay.style.display = 'flex';
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.display = 'none';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        async function analyzeText() {
            const text = document.getElementById('analysis-text').value.trim();
            if (!text) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå');
                return;
            }

            try {
                showLoading();
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ API ‡∏à‡∏≤‡∏Å ai_service.py
                const response = await fetch('http://localhost:5000/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text })
                });
                
                if (!response.ok) {
                    throw new Error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
                }
                
                const result = await response.json();
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                const analysisResult = processAnalysisResult(result, text);
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                window.lastAnalysisResult = analysisResult;
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                updateCharts(analysisResult);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
                const saveBtn = document.getElementById('save-btn');
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser) {
                    saveBtn.style.display = 'inline-block';
                    document.getElementById('history-btn').style.display = 'inline-block';
                } else {
                    document.getElementById('login-prompt').style.display = 'block';
                }

            } catch (error) {
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message);
                console.error('Analysis error:', error);
            } finally {
                hideLoading();
            }
        }
        
        // ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å API ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function processAnalysisResult(apiResult, originalText) {
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const sentimentMap = {
                'positive': '‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å',
                'negative': '‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö',
                'neutral': '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á'
            };
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å sentiment_ratios ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
            const sentimentRatios = apiResult.details?.sentiment_ratios || { positive: 0, negative: 0, neutral: 0 };
            const positivePercent = Math.round(sentimentRatios.positive * 100);
            const neutralPercent = Math.round(sentimentRatios.neutral * 100);
            const negativePercent = Math.round(sentimentRatios.negative * 100);
            
            // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å backend ‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô found_words ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const positiveKeywords = apiResult.details?.found_positive_words || [];
            const negativeKeywords = apiResult.details?.found_negative_words || [];
            const neutralKeywords = apiResult.details?.found_neutral_words || [];
            const durianTypes = apiResult.details?.found_durian_types || [];
            
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° '-' ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const emptyKeywords = ['-'];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç
            let suggestions = [];
            
            if (positivePercent > negativePercent) {
                suggestions = [
                    `‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°${positiveKeywords.length > 0 ? ` ${positiveKeywords[0]}` : ''} ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏ô`,
                    `‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡∏ó‡∏≠‡∏á‡πÅ‡∏ó‡πâ ‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°${positiveKeywords.length > 1 ? positiveKeywords[1] : '‡∏≠‡∏£‡πà‡∏≠‡∏¢'}`,
                    `‡∏•‡∏¥‡πâ‡∏°‡∏£‡∏™‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å ‡∏£‡∏≤‡∏ä‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏ú‡∏•‡πÑ‡∏°‡πâ`
                ];
            } else if (negativePercent > positivePercent) {
                if (negativeKeywords.includes('‡πÅ‡∏û‡∏á') || originalText.includes('‡∏£‡∏≤‡∏Ñ‡∏≤')) {
                    suggestions = [
                        "‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡πà‡∏≠‡∏°‡πÄ‡∏¢‡∏≤",
                        "‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å",
                        "‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡πÅ‡∏ñ‡∏° 1 ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤"
                    ];
                } else {
                    suggestions = [
                        "‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á",
                        "‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
                        "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏Ñ‡∏±‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏∏‡∏Å‡∏•‡∏π‡∏Å"
                    ];
                }
            } else {
                suggestions = [
                    "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡∏ó‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£",
                    "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏ô ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì",
                    "‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© 15%"
                ];
            }
            
            return {
                sentiment: {
                    positive: positivePercent,
                    neutral: neutralPercent,
                    negative: negativePercent
                },
                keywords: {
                    positive: positiveKeywords.length > 0 ? positiveKeywords : emptyKeywords,
                    neutral: neutralKeywords.length > 0 ? neutralKeywords : emptyKeywords,
                    negative: negativeKeywords.length > 0 ? negativeKeywords : emptyKeywords,
                    durian_types: durianTypes.length > 0 ? durianTypes : emptyKeywords
                },
                suggestions: suggestions,
                sentiment_text: sentimentMap[apiResult.sentiment] || apiResult.sentiment,
                confidence: apiResult.confidence
            };
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
        function showError(message) {
            const errorModal = document.getElementById('error-modal');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorModal.style.display = 'flex';
        }

        function closeErrorModal() {
            document.getElementById('error-modal').style.display = 'none';
        }

        function updateSentimentData() {
            const newData = [
                Math.floor(Math.random() * 30) + 50,
                Math.floor(Math.random() * 20) + 20,
                Math.floor(Math.random() * 10) + 5
            ];
            window.sentimentChart.data.datasets[0].data = newData;
            window.sentimentChart.update();

            document.querySelectorAll('.metric-value').forEach((el, i) => {
                el.textContent = newData[i] + '%';
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
        function updateTimeframe(period) {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°
            document.querySelectorAll('.trend-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
            const timeframeData = {
                daily: {
                    labels: ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå', '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'],
                    data: [1200, 1900, 3000, 5000, 4000, 3500, 4200],
                    title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô'
                },
                weekly: {
                    labels: ['‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 1', '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 2', '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 3', '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà 4'],
                    data: [15000, 25000, 30000, 45000],
                    title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå'
                },
                monthly: {
                    labels: ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô'],
                    data: [50000, 80000, 120000, 90000, 110000, 130000],
                    title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
                }
            };

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü
            if (window.trendChart) {
                window.trendChart.data.labels = timeframeData[period].labels;
                window.trendChart.data.datasets[0].data = timeframeData[period].data;
                window.trendChart.options.plugins.title.text = timeframeData[period].title;
                window.trendChart.update();
            }
        }

        function showTooltip(event, text) {
            const tooltip = document.querySelector('.tooltip');
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY + 10 + 'px';
            tooltip.textContent = text;

            event.target.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        }

        function showToast(message) {
            const toast = document.getElementById('analyze-toast');
            toast.textContent = message;
            toast.style.display = 'block';
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 300);
            }, 3000);
        }

        function saveAnalysis() {
            const text = document.getElementById('analysis-text').value.trim();
            if (!text) {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                return;
            }

            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏¥‡∏°
                const history = JSON.parse(localStorage.getItem('durian_history') || '[]');
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const lastAnalysisResult = window.lastAnalysisResult;
                if (!lastAnalysisResult) {
                    showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                    return;
                }
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏£‡∏¥‡∏á
                const newAnalysis = {
                    text: text,
                    date: new Date().toLocaleString('th-TH'),
                    sentiment: lastAnalysisResult.sentiment_text,
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö history.html
                    keywords: [
                        ...lastAnalysisResult.keywords.positive.filter(k => k !== '-'),
                        ...lastAnalysisResult.keywords.neutral.filter(k => k !== '-'),
                        ...lastAnalysisResult.keywords.negative.filter(k => k !== '-')
                    ],
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
                    confidence: Math.round(lastAnalysisResult.confidence * 100),
                    sentiment_ratio: {
                        positive: lastAnalysisResult.sentiment.positive,
                        neutral: lastAnalysisResult.sentiment.neutral,
                        negative: lastAnalysisResult.sentiment.negative
                    },
                    full_keywords: {
                        positive: lastAnalysisResult.keywords.positive.filter(k => k !== '-'),
                        neutral: lastAnalysisResult.keywords.neutral.filter(k => k !== '-'),
                        negative: lastAnalysisResult.keywords.negative.filter(k => k !== '-')
                    }
                };
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                history.unshift(newAnalysis);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
                localStorage.setItem('durian_history', JSON.stringify(history));
                
                showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                document.getElementById('save-btn').style.display = 'none';
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        function updateCharts(result) {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å
            window.sentimentChart.data.datasets[0].data = [
                result.sentiment.positive,
                result.sentiment.neutral,
                result.sentiment.negative
            ];
            window.sentimentChart.update();

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
            document.querySelectorAll('.metric-value')[0].textContent = result.sentiment.positive + '%';
            document.querySelectorAll('.metric-value')[1].textContent = result.sentiment.neutral + '%';
            document.querySelectorAll('.metric-value')[2].textContent = result.sentiment.negative + '%';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ metric-label ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏î
            document.querySelectorAll('.metric-label')[0].textContent = '‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å';
            document.querySelectorAll('.metric-label')[1].textContent = '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
            document.querySelectorAll('.metric-label')[2].textContent = '‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö';

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
            updateKeywords(result.keywords);

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            updateSuggestions(result.suggestions);
        }

        function updateKeywords(keywords) {
            const keywordContainers = document.querySelectorAll('.keyword-list');
            
            // ‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å
            let positiveHTML = '';
            if (keywords.positive.length > 0 && keywords.positive[0] !== '-') {
                keywords.positive.forEach(word => {
                    positiveHTML += `<span class="keyword-item">${word}</span>`;
                });
            } else {
                positiveHTML = '<span class="keyword-item empty-keyword">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å</span>';
            }
            keywordContainers[0].innerHTML = positiveHTML;

            // ‡∏Ñ‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á
            let neutralHTML = '';
            if (keywords.neutral.length > 0 && keywords.neutral[0] !== '-') {
                keywords.neutral.forEach(word => {
                    neutralHTML += `<span class="keyword-item">${word}</span>`;
                });
            } else {
                neutralHTML = '<span class="keyword-item empty-keyword">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>';
            }
            keywordContainers[1].innerHTML = neutralHTML;

            // ‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö
            let negativeHTML = '';
            if (keywords.negative.length > 0 && keywords.negative[0] !== '-') {
                keywords.negative.forEach(word => {
                    negativeHTML += `<span class="keyword-item">${word}</span>`;
                });
            } else {
                negativeHTML = '<span class="keyword-item empty-keyword">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö</span>';
            }
            keywordContainers[2].innerHTML = negativeHTML;
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (keywords.durian_types && keywords.durian_types.length > 0 && keywords.durian_types[0] !== '-') {
                // ‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                const additionalInfoArea = document.querySelector('.keyword-analysis');
                if (additionalInfoArea) {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    let durianTypeSection = document.querySelector('.keyword-category.durian-types');
                    
                    if (!durianTypeSection) {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà
                        durianTypeSection = document.createElement('div');
                        durianTypeSection.className = 'keyword-category durian-types';
                        durianTypeSection.innerHTML = `
                            <div class="keyword-title">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                            <div class="keyword-list durian-types-list"></div>
                        `;
                        additionalInfoArea.appendChild(durianTypeSection);
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    const durianTypesListElement = durianTypeSection.querySelector('.durian-types-list');
                    let durianTypesHTML = '';
                    keywords.durian_types.forEach(type => {
                        durianTypesHTML += `<span class="keyword-item durian-type-item">${type}</span>`;
                    });
                    durianTypesListElement.innerHTML = durianTypesHTML;
                }
            }
        }

        function updateSuggestions(suggestions) {
            const suggestionContainer = document.querySelector('.campaign-suggestions');
            let html = '';
            suggestions.forEach(suggestion => {
                html += `<div class="suggestion-item">"${suggestion}"</div>`;
            });
            suggestionContainer.innerHTML = html;
        }
    </script>

    <style>
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö empty-keyword */
    .empty-keyword {
        background-color: #f5f5f5;
        color: #888;
        font-style: italic;
    }
    
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥ */
    .found-words {
        margin-top: 16px;
        padding: 12px;
        background: rgba(74, 216, 185, 0.1);
        border-radius: 8px;
        border: 1px solid #e1e8f0;
    }
    
    .found-words p {
        margin: 8px 0;
    }
    
    .found-words strong {
        color: #4AD8B9;
        font-weight: 600;
    }
    
    .result-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e1e8f0;
        margin-top: 16px;
    }
    
    .result-card h3 {
        color: #4AD8B9;
        margin-bottom: 16px;
        border-bottom: 1px solid #e1e8f0;
        padding-bottom: 8px;
    }
    
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Keyword Item */
    .keyword-item {
        display: inline-block;
        padding: 6px 12px;
        background: white;
        border-radius: 20px;
        margin: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border: 1px solid #e1e8f0;
        font-size: 0.9em;
        transition: all 0.2s ease;
    }
    
    .keyword-item:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Loading Spinner */
    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--background-color);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Textarea */
    #analysis-text {
        width: 100%;
        min-height: 120px;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 1em;
        resize: vertical;
        transition: border-color 0.3s;
    }

    #analysis-text:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Error Message */
    .text-validation {
        transition: all 0.3s;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Button Group */
    .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        flex-wrap: wrap;
        align-items: center;
    }

    .button-group > * {
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-size: 1em;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .interactive-button {
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
    }

    .interactive-button:hover {
        background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
        transform: translateY(-1px);
    }

    .history-button {
        background: var(--background-color);
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
    }

    .history-button:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-1px);
    }

    .save-button {
        background: var(--secondary-color);
        color: white;
        border: none;
    }

    .save-button:hover {
        background: var(--accent-color);
        transform: translateY(-1px);
    }

    .history-icon, .save-icon {
        font-size: 1.2em;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Login Prompt */
    .login-prompt {
        color: var(--text-color);
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .login-prompt .login-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }

    .login-prompt .login-link:hover {
        text-decoration: underline;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Navbar */
    .navbar {
        background-color: var(--card-background);
        padding: 1.5rem 2.5rem;
        box-shadow: var(--shadow-sm);
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 20px;
    }

    .nav-brand {
        display: flex;
        align-items: center;
    }

    .nav-logo {
        width: 60px;
        height: 60px;
        margin-right: 15px;
    }

    .nav-brand h1 {
        font-size: 1.8rem;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Container */
    .container {
        max-width: 1300px;
        padding: 0 2rem;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Dashboard Title */
    .dashboard-title {
        margin: 2rem 0 3rem;
    }

    .dashboard-title h1 {
        font-size: 2.8rem;
        margin-bottom: 1rem;
    }

    .dashboard-title p {
        font-size: 1.2rem;
        max-width: 700px;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ */
    .trend-filters {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
    }

    .trend-filter {
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        background: white;
        color: var(--text-color);
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
    }

    .trend-filter:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .trend-filter.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    </style>
</body>
</html> 